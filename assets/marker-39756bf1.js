import{j as E,F as T}from"./jsx-runtime-29545a09.js";import{r as d,R as j}from"./index-76fb7be0.js";import{M as P}from"./mapbox-gl-801b965a.js";import{u as I}from"./index-469f73fa.js";import{u as D,b as w}from"./map-d3e02d13.js";import{r as k}from"./index-da03a860.js";function O(e,r){return typeof e=="function"?e.length?e(r):e():e}function R(e,r){return q(e)||_(e,r)||V(e,r)||$()}function $(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function V(e,r){if(e){if(typeof e=="string")return A(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return A(e,r)}}function A(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function _(e,r){var t=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,o,l,i,s=[],c=!0,u=!1;try{if(l=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;c=!1}else for(;!(c=(n=l.call(t)).done)&&(s.push(n.value),s.length!==r);c=!0);}catch(m){u=!0,o=m}finally{try{if(!c&&t.return!=null&&(i=t.return(),Object(i)!==i))return}finally{if(u)throw o}}return s}}function q(e){if(Array.isArray(e))return e}function N(e){var r=d.useState(e),t=R(r,2),n=t[0],o=t[1],l=d.useRef(n);l.current=n;var i=d.useCallback(function(c){l.current=O(c,l.current),o(l.current)},[]),s=d.useCallback(function(){return l.current},[]);return[n,i,s]}function S(e,r){return W(e)||U(e,r)||F(e,r)||H()}function H(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function F(e,r){if(e){if(typeof e=="string")return L(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return L(e,r)}}function L(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function U(e,r){var t=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,o,l,i,s=[],c=!0,u=!1;try{if(l=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;c=!1}else for(;!(c=(n=l.call(t)).done)&&(s.push(n.value),s.length!==r);c=!0);}catch(m){u=!0,o=m}finally{try{if(!c&&t.return!=null&&(i=t.return(),Object(i)!==i))return}finally{if(u)throw o}}return s}}function W(e){if(Array.isArray(e))return e}var x=function(){var r=d.useState(function(){return document.createElement("div")}),t=S(r,1),n=t[0],o=d.useState({render:function(){return null},remove:function(){return null}}),l=S(o,2),i=l[0],s=l[1],c=d.useCallback(function(u){var m=function(v){var a=v.children;return a?k.createPortal(a,u):null},p=function(v){v&&k.unmountComponentAtNode(v)};return{render:m,remove:p}},[]);return d.useEffect(function(){n&&i.remove();var u=c(n);return s(u),function(){u.remove(n)}},[n]),{Portal:i.render,container:n}};const B=e=>{if(!e)return null;if("toBounds"in e)return e;let r=0,t=0;return Array.isArray(e)?(r=e[0],t=e[1]):"lng"in e&&"lat"in e?(r=e.lng,t=e.lat):"lon"in e&&"lat"in e&&(r=e.lon,t=e.lat),r!==0&&t!==0?new P.LngLat(r,t):null},G=["anchor","clickTolerance","color","scale"],z=["offset","draggable","rotation","rotationAlignment","pitchAlignment","occludedOpacity","lngLat"],J=z.concat(G),K={},g={lngLat:B},C={onDragStart:"dragstart",onDrag:"drag",onDragEnd:"dragend"},Q=Object.keys(C),M=j.forwardRef((e,r)=>{const{map:t}=I(),{Portal:n,container:o}=x(),[l,i,s]=N(),{onInstanceCreated:c}=D(e,l,{setterMap:K,converterMap:g});w(l,e,{eventMap:C,eventList:Q}),d.useImperativeHandle(r,()=>l,[l]);const u=a=>{var f;(f=e.onClick)==null||f.call(e,{type:"click",target:s(),originalEvent:a})},m=a=>{a.stopPropagation(),a.preventDefault()};d.useEffect(()=>(t&&p().then(a=>{i(a),a.addTo(t),o.addEventListener("click",u),o.addEventListener("dblclick",m),c()}),()=>{o&&(o.removeEventListener("click",u),o.removeEventListener("dblclick",u))}),[t]);const p=()=>{const a=b(e);if(a.lngLat){const f=new P.Marker(o,a);return f.setLngLat(a.lngLat),Promise.resolve(f)}else return Promise.reject()},b=a=>{const f={};return J.forEach(y=>{y in a&&(f[y]=v(y,a))}),f},v=(a,f)=>{var h;let y=f[a];if(a in g)try{y=(h=g[a])==null?void 0:h.call(g,f[a])}catch{}return y};return E(T,{children:l&&E(n,{children:e.children})})});try{M.displayName="Marker",M.__docgenInfo={description:"",displayName:"Marker",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},lngLat:{defaultValue:null,description:"经纬度坐标",name:"lngLat",required:!1,type:{name:"LngLatLike"}},onDragStart:{defaultValue:null,description:"",name:"onDragStart",required:!1,type:{name:"((e: MarkerEvent<MouseEvent | TouchEvent>) => void)"}},onDrag:{defaultValue:null,description:"",name:"onDrag",required:!1,type:{name:"((e: MarkerEvent<MouseEvent | TouchEvent>) => void)"}},onDragEnd:{defaultValue:null,description:"",name:"onDragEnd",required:!1,type:{name:"((e: MarkerEvent<MouseEvent | TouchEvent>) => void)"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"((e: MarkerEvent<Event>) => void)"}}}}}catch{}export{M};
