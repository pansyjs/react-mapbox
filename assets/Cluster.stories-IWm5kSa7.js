import{a as q,j as c}from"./jsx-runtime-5BUNAZ9W.js";import{r as u,R as V}from"./index-4g5l5LRQ.js";import{L as z}from"./Language-ZUxNu0xw.js";import{u as b,S as v}from"./index-awTSSYoP.js";import{d as h,M as C}from"./map-8v-jDlzj.js";import"./_commonjsHelpers-4gQjN7DL.js";import"./mapbox-gl-0eWPQeFN.js";const p=t=>t.style&&t.style._loaded;function S(t,e){if(!t)throw new Error(e)}function I(t,e,n){if(p(t)){const r={...n};return delete r.id,delete r.children,t.addSource(e,r),t.getSource(e)}}function j(t,e,n){S(e.id===n.id,"source id changed"),S(e.type===n.type,"source type changed");let r="",a=0;for(const o in e)o!=="children"&&o!=="id"&&!h(n[o],e[o])&&(r=o,a++);if(!a)return;const i=e.type;if(i==="geojson")t.setData(e.data);else if(i==="image")t.updateImage({url:e.url,coordinates:e.coordinates});else if("setCoordinates"in t&&a===1&&r==="coordinates")t.setCoordinates(e.coordinates);else if("setUrl"in t)switch(r){case"url":t.setUrl(e.url);break;case"tiles":t.setTiles(e.tiles);break}else console.warn(`Unable to update <Source> prop: ${r}`)}let w=0;function _(t){const{map:e}=b(),n=u.useRef(t),[,r]=u.useState(0),a=u.useMemo(()=>t.id||`jsx-source-${w++}`,[]);u.useEffect(()=>{if(e){const o=()=>setTimeout(()=>r(s=>s+1),0);return e.on("styledata",o),o(),()=>{var s;if(e.off("styledata",o),e.getStyle()&&p(e)&&e.getSource(a)){const d=(s=e.getStyle())==null?void 0:s.layers;if(d)for(const f of d)f.source===a&&e.removeLayer(f.id);e.removeSource(a)}}}},[e]);let i=e&&e.getStyle()&&e.getSource(a);return i?j(i,t,n.current):i=I(e,a,t),n.current=t,i&&V.Children.map(t.children,o=>o&&u.cloneElement(o,{source:a}))||null}try{_.displayName="Source",_.__docgenInfo={description:"",displayName:"Source",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"string"}},type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"custom"'},{value:'"geojson"'},{value:'"video"'},{value:'"image"'},{value:'"canvas"'},{value:'"vector"'},{value:'"raster"'},{value:'"raster-dem"'}]}},scheme:{defaultValue:null,description:"",name:"scheme",required:!1,type:{name:"string"}},minzoom:{defaultValue:null,description:"",name:"minzoom",required:!1,type:{name:"number"}},maxzoom:{defaultValue:null,description:"",name:"maxzoom",required:!1,type:{name:"number"}},tileSize:{defaultValue:null,description:"",name:"tileSize",required:!1,type:{name:"number"}},attribution:{defaultValue:null,description:"",name:"attribution",required:!1,type:{name:"string"}},_implementation:{defaultValue:null,description:"",name:"_implementation",required:!0,type:{name:"CustomSourceImplementation<unknown>"}}}}}catch{}function E(t,e,n){if(p(t)&&(!("source"in n)||t.getSource(n.source))){const r={...n,id:e};delete r.beforeId,t.addLayer(r,n.beforeId)}}function M(t,e,n,r){if(S(n.id===r.id,"layer id changed"),S(n.type===r.type,"layer type changed"),n.type==="custom"||r.type==="custom")return;const{layout:a={},paint:i={},filter:o,minzoom:s,maxzoom:d,beforeId:f}=n;if(f!==r.beforeId&&t.moveLayer(e,f),a!==r.layout){const m=r.layout||{};for(const l in a)h(a[l],m[l])||t.setLayoutProperty(e,l,a[l]);for(const l in m)a.hasOwnProperty(l)||t.setLayoutProperty(e,l,void 0)}if(i!==r.paint){const m=r.paint||{};for(const l in i)h(i[l],m[l])||t.setPaintProperty(e,l,i[l]);for(const l in m)i.hasOwnProperty(l)||t.setPaintProperty(e,l,void 0)}h(o,r.filter)||t.setFilter(e,o),(s!==r.minzoom||d!==r.maxzoom)&&t.setLayerZoomRange(e,s,d)}let R=0;const y=t=>{const{map:e}=b(),n=u.useRef(t),[,r]=u.useState(0),a=u.useMemo(()=>t.id||`jsx-layer-${R++}`,[]);if(u.useEffect(()=>{if(e){const o=()=>r(s=>s+1);return e.on("styledata",o),o(),()=>{e.off("styledata",o),p(e)&&e.getLayer(a)&&e.removeLayer(a)}}},[e]),p(e)&&e.getLayer(a))try{M(e,a,t,n.current)}catch(o){console.warn(o)}else E(e,a,t);return n.current=t,null};try{y.displayName="Layer",y.__docgenInfo={description:"",displayName:"Layer",props:{type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"string"}},minzoom:{defaultValue:null,description:"",name:"minzoom",required:!1,type:{name:"number"}},maxzoom:{defaultValue:null,description:"",name:"maxzoom",required:!1,type:{name:"number"}},filter:{defaultValue:null,description:"",name:"filter",required:!1,type:{name:"any"}},source:{defaultValue:null,description:"",name:"source",required:!1,type:{name:"unknown"}},metadata:{defaultValue:null,description:"",name:"metadata",required:!1,type:{name:"any"}},layout:{defaultValue:null,description:"",name:"layout",required:!1,type:{name:"{ [property: string]: any; }"}},paint:{defaultValue:null,description:"",name:"paint",required:!1,type:{name:"{ [property: string]: any; }"}},id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"string"}},beforeId:{defaultValue:null,description:"",name:"beforeId",required:!1,type:{name:"string"}}}}}catch{}const U={id:"clusters",type:"circle",source:"earthquakes",filter:["has","point_count"],paint:{"circle-color":["step",["get","point_count"],"#51bbd6",100,"#f1f075",750,"#f28cb1"],"circle-radius":["step",["get","point_count"],20,100,30,750,40]}},N={id:"cluster-count",type:"symbol",source:"earthquakes",filter:["has","point_count"],layout:{"text-field":"{point_count_abbreviated}","text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":12}},O={id:"unclustered-point",type:"circle",source:"earthquakes",filter:["!",["has","point_count"]],paint:{"circle-color":"#11b4da","circle-radius":4,"circle-stroke-width":1,"circle-stroke-color":"#fff"}},T=()=>{const{map:t}=b();return u.useEffect(()=>{t&&t.on("click","clusters",e=>{var a;const n=t.queryRenderedFeatures(e.point,{layers:["clusters"]}),r=(a=n[0].properties)==null?void 0:a.cluster_id;t.getSource("earthquakes").getClusterExpansionZoom(r,(i,o)=>{i||t.easeTo({center:n[0].geometry.coordinates,zoom:o})})})},[t]),null},G={title:"示例/Cluster",render:()=>q(C,{zoom:3,center:[-103.5917,40.6699],style:"mapbox://styles/mapbox/dark-v11",containerStyle:{height:"100vh"},children:[c(v,{children:q(_,{id:"earthquakes",type:"geojson",data:"https://docs.mapbox.com/mapbox-gl-js/assets/earthquakes.geojson",cluster:!0,clusterMaxZoom:14,clusterRadius:50,children:[c(y,{...U}),c(y,{...N}),c(y,{...O}),c(T,{})]})}),c(z,{})]}),parameters:{layout:"fullscreen"},argTypes:{},args:{lngLat:[-122.414,37.776]}},g={args:{}};var L,x,k;g.parameters={...g.parameters,docs:{...(L=g.parameters)==null?void 0:L.docs,source:{originalSource:`{
  args: {}
}`,...(k=(x=g.parameters)==null?void 0:x.docs)==null?void 0:k.source}}};const H=["Cluster"];export{g as Cluster,H as __namedExportsOrder,G as default};
