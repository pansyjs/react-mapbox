import{j as E,F as C}from"./jsx-runtime-5BUNAZ9W.js";import{M as _}from"./mapbox-gl-0eWPQeFN.js";import{r as d}from"./index-4g5l5LRQ.js";import{u as T}from"./index-tNdqmU4a.js";import{u as I,b as D}from"./map-UcjS3gf5.js";import{r as k}from"./index-im-bjvvC.js";function j(e,r){return typeof e=="function"?e.length?e(r):e():e}function w(e,r){return V(e)||R(e,r)||$(e,r)||O()}function O(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $(e,r){if(e){if(typeof e=="string")return A(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return A(e,r)}}function A(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function R(e,r){var t=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,l,o,u,i=[],s=!0,c=!1;try{if(o=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;s=!1}else for(;!(s=(n=o.call(t)).done)&&(i.push(n.value),i.length!==r);s=!0);}catch(y){c=!0,l=y}finally{try{if(!s&&t.return!=null&&(u=t.return(),Object(u)!==u))return}finally{if(c)throw l}}return i}}function V(e){if(Array.isArray(e))return e}function q(e){var r=d.useState(e),t=w(r,2),n=t[0],l=t[1],o=d.useRef(n);o.current=n;var u=d.useCallback(function(s){o.current=j(s,o.current),l(o.current)},[]),i=d.useCallback(function(){return o.current},[]);return[n,u,i]}function S(e,r){return x(e)||F(e,r)||H(e,r)||N()}function N(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function H(e,r){if(e){if(typeof e=="string")return L(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return L(e,r)}}function L(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function F(e,r){var t=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],l=!0,o=!1,u,i;try{for(t=t.call(e);!(l=(u=t.next()).done)&&(n.push(u.value),!(r&&n.length===r));l=!0);}catch(s){o=!0,i=s}finally{try{!l&&t.return!=null&&t.return()}finally{if(o)throw i}}return n}}function x(e){if(Array.isArray(e))return e}var U=function(){var r=d.useState(function(){return document.createElement("div")}),t=S(r,1),n=t[0],l=d.useState({render:function(){return null},remove:function(){return null}}),o=S(l,2),u=o[0],i=o[1],s=d.useCallback(function(c){var y=function(m){var a=m.children;return a?k.createPortal(a,c):null},p=function(m){m&&k.unmountComponentAtNode(m)};return{render:y,remove:p}},[]);return d.useEffect(function(){n&&u.remove();var c=s(n);return i(c),function(){c.remove(n)}},[n]),{Portal:u.render,container:n}};const W=e=>{if(!e)return null;if("toBounds"in e)return e;let r=0,t=0;return Array.isArray(e)?(r=e[0],t=e[1]):"lng"in e&&"lat"in e?(r=e.lng,t=e.lat):"lon"in e&&"lat"in e&&(r=e.lon,t=e.lat),r!==0&&t!==0?new _.LngLat(r,t):null},B=["anchor","clickTolerance","color","scale"],G=["offset","draggable","rotation","rotationAlignment","pitchAlignment","occludedOpacity","lngLat"],z=G.concat(B),J={},g={lngLat:W},P={onDragStart:"dragstart",onDrag:"drag",onDragEnd:"dragend"},K=Object.keys(P),M=d.forwardRef((e,r)=>{const{map:t}=T(),{Portal:n,container:l}=U(),[o,u,i]=q(),{onInstanceCreated:s}=I(e,o,{setterMap:J,converterMap:g});D(o,e,{eventMap:P,eventList:K}),d.useImperativeHandle(r,()=>o,[o]);const c=a=>{var f;(f=e.onClick)==null||f.call(e,{type:"click",target:i(),originalEvent:a})},y=a=>{a.stopPropagation(),a.preventDefault()};d.useEffect(()=>(t&&p().then(a=>{u(a),a.addTo(t),l.addEventListener("click",c),l.addEventListener("dblclick",y),s()}),()=>{l&&(l.removeEventListener("click",c),l.removeEventListener("dblclick",c))}),[t]);const p=()=>{const a=b(e);if(a.lngLat){const f=new _.Marker(l,a);return f.setLngLat(a.lngLat),Promise.resolve(f)}else return Promise.reject()},b=a=>{const f={};return z.forEach(v=>{v in a&&(f[v]=m(v,a))}),f},m=(a,f)=>{var h;let v=f[a];if(a in g)try{v=(h=g[a])==null?void 0:h.call(g,f[a])}catch{}return v};return E(C,{children:o&&E(n,{children:e.children})})});try{M.displayName="Marker",M.__docgenInfo={description:"",displayName:"Marker",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},lngLat:{defaultValue:null,description:"经纬度坐标",name:"lngLat",required:!1,type:{name:"LngLatLike"}},onDragStart:{defaultValue:null,description:"",name:"onDragStart",required:!1,type:{name:"((e: MarkerEvent<MouseEvent | TouchEvent>) => void)"}},onDrag:{defaultValue:null,description:"",name:"onDrag",required:!1,type:{name:"((e: MarkerEvent<MouseEvent | TouchEvent>) => void)"}},onDragEnd:{defaultValue:null,description:"",name:"onDragEnd",required:!1,type:{name:"((e: MarkerEvent<MouseEvent | TouchEvent>) => void)"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"((e: MarkerEvent<Event>) => void)"}}}}}catch{}export{M};
