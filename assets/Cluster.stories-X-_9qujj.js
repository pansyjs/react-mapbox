import{a as L,j as c}from"./jsx-runtime-5BUNAZ9W.js";import{r as u,R as V}from"./index-4g5l5LRQ.js";import{L as z}from"./Language-0XBOD4Xk.js";import{u as q,S as j}from"./index-_W0WQwje.js";import{M as v}from"./map-UcjS3gf5.js";import"./_commonjsHelpers-4gQjN7DL.js";import"./mapbox-gl-0eWPQeFN.js";const g=t=>t.style&&t.style._loaded;function S(t,e){if(!t)throw new Error(e)}function d(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!d(t[r],e[r]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),a=Object.keys(e);if(r.length!==a.length)return!1;for(const n of r)if(!e.hasOwnProperty(n)||!d(t[n],e[n]))return!1;return!0}return!1}function C(t,e,r){if(g(t)){const a={...r};return delete a.id,delete a.children,t.addSource(e,a),t.getSource(e)}}function I(t,e,r){S(e.id===r.id,"source id changed"),S(e.type===r.type,"source type changed");let a="",n=0;for(const o in e)o!=="children"&&o!=="id"&&!d(r[o],e[o])&&(a=o,n++);if(!n)return;const i=e.type;if(i==="geojson")t.setData(e.data);else if(i==="image")t.updateImage({url:e.url,coordinates:e.coordinates});else if("setCoordinates"in t&&n===1&&a==="coordinates")t.setCoordinates(e.coordinates);else if("setUrl"in t)switch(a){case"url":t.setUrl(e.url);break;case"tiles":t.setTiles(e.tiles);break}else console.warn(`Unable to update <Source> prop: ${a}`)}let w=0;function _(t){const{map:e}=q(),r=u.useRef(t),[,a]=u.useState(0),n=u.useMemo(()=>t.id||`jsx-source-${w++}`,[]);u.useEffect(()=>{if(e){const o=()=>setTimeout(()=>a(s=>s+1),0);return e.on("styledata",o),o(),()=>{var s;if(e.off("styledata",o),e.getStyle()&&g(e)&&e.getSource(n)){const f=(s=e.getStyle())==null?void 0:s.layers;if(f)for(const y of f)y.source===n&&e.removeLayer(y.id);e.removeSource(n)}}}},[e]);let i=e&&e.getStyle()&&e.getSource(n);return i?I(i,t,r.current):i=C(e,n,t),r.current=t,i&&V.Children.map(t.children,o=>o&&u.cloneElement(o,{source:n}))||null}try{_.displayName="Source",_.__docgenInfo={description:"",displayName:"Source",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"string"}},type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"custom"'},{value:'"geojson"'},{value:'"video"'},{value:'"image"'},{value:'"canvas"'},{value:'"vector"'},{value:'"raster"'},{value:'"raster-dem"'}]}},scheme:{defaultValue:null,description:"",name:"scheme",required:!1,type:{name:"string"}},minzoom:{defaultValue:null,description:"",name:"minzoom",required:!1,type:{name:"number"}},maxzoom:{defaultValue:null,description:"",name:"maxzoom",required:!1,type:{name:"number"}},tileSize:{defaultValue:null,description:"",name:"tileSize",required:!1,type:{name:"number"}},attribution:{defaultValue:null,description:"",name:"attribution",required:!1,type:{name:"string"}},_implementation:{defaultValue:null,description:"",name:"_implementation",required:!0,type:{name:"CustomSourceImplementation<unknown>"}}}}}catch{}function E(t,e,r){if(g(t)&&(!("source"in r)||t.getSource(r.source))){const a={...r,id:e};delete a.beforeId,t.addLayer(a,r.beforeId)}}function M(t,e,r,a){if(S(r.id===a.id,"layer id changed"),S(r.type===a.type,"layer type changed"),r.type==="custom"||a.type==="custom")return;const{layout:n={},paint:i={},filter:o,minzoom:s,maxzoom:f,beforeId:y}=r;if(y!==a.beforeId&&t.moveLayer(e,y),n!==a.layout){const m=a.layout||{};for(const l in n)d(n[l],m[l])||t.setLayoutProperty(e,l,n[l]);for(const l in m)n.hasOwnProperty(l)||t.setLayoutProperty(e,l,void 0)}if(i!==a.paint){const m=a.paint||{};for(const l in i)d(i[l],m[l])||t.setPaintProperty(e,l,i[l]);for(const l in m)i.hasOwnProperty(l)||t.setPaintProperty(e,l,void 0)}d(o,a.filter)||t.setFilter(e,o),(s!==a.minzoom||f!==a.maxzoom)&&t.setLayerZoomRange(e,s,f)}let R=0;const p=t=>{const{map:e}=q(),r=u.useRef(t),[,a]=u.useState(0),n=u.useMemo(()=>t.id||`jsx-layer-${R++}`,[]);if(u.useEffect(()=>{if(e){const o=()=>a(s=>s+1);return e.on("styledata",o),o(),()=>{e.off("styledata",o),g(e)&&e.getLayer(n)&&e.removeLayer(n)}}},[e]),g(e)&&e.getLayer(n))try{M(e,n,t,r.current)}catch(o){console.warn(o)}else E(e,n,t);return r.current=t,null};try{p.displayName="Layer",p.__docgenInfo={description:"",displayName:"Layer",props:{type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"string"}},source:{defaultValue:null,description:"",name:"source",required:!1,type:{name:"unknown"}},metadata:{defaultValue:null,description:"",name:"metadata",required:!1,type:{name:"any"}},minzoom:{defaultValue:null,description:"",name:"minzoom",required:!1,type:{name:"number"}},maxzoom:{defaultValue:null,description:"",name:"maxzoom",required:!1,type:{name:"number"}},filter:{defaultValue:null,description:"",name:"filter",required:!1,type:{name:"any"}},layout:{defaultValue:null,description:"",name:"layout",required:!1,type:{name:"{ [property: string]: any; }"}},paint:{defaultValue:null,description:"",name:"paint",required:!1,type:{name:"{ [property: string]: any; }"}},id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"string"}},beforeId:{defaultValue:null,description:"",name:"beforeId",required:!1,type:{name:"string"}}}}}catch{}const A={id:"clusters",type:"circle",source:"earthquakes",filter:["has","point_count"],paint:{"circle-color":["step",["get","point_count"],"#51bbd6",100,"#f1f075",750,"#f28cb1"],"circle-radius":["step",["get","point_count"],20,100,30,750,40]}},O={id:"cluster-count",type:"symbol",source:"earthquakes",filter:["has","point_count"],layout:{"text-field":"{point_count_abbreviated}","text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":12}},U={id:"unclustered-point",type:"circle",source:"earthquakes",filter:["!",["has","point_count"]],paint:{"circle-color":"#11b4da","circle-radius":4,"circle-stroke-width":1,"circle-stroke-color":"#fff"}},N=()=>{const{map:t}=q();return u.useEffect(()=>{t&&t.on("click","clusters",e=>{var n;const r=t.queryRenderedFeatures(e.point,{layers:["clusters"]}),a=(n=r[0].properties)==null?void 0:n.cluster_id;t.getSource("earthquakes").getClusterExpansionZoom(a,(i,o)=>{i||t.easeTo({center:r[0].geometry.coordinates,zoom:o})})})},[t]),null},G={title:"示例/Cluster",render:()=>L(v,{zoom:3,center:[-103.5917,40.6699],style:"mapbox://styles/mapbox/dark-v11",containerStyle:{height:"100vh"},children:[c(j,{children:L(_,{id:"earthquakes",type:"geojson",data:"https://docs.mapbox.com/mapbox-gl-js/assets/earthquakes.geojson",cluster:!0,clusterMaxZoom:14,clusterRadius:50,children:[c(p,{...A}),c(p,{...O}),c(p,{...U}),c(N,{})]})}),c(z,{})]}),parameters:{layout:"fullscreen"},argTypes:{},args:{lngLat:[-122.414,37.776]}},h={args:{}};var b,k,x;h.parameters={...h.parameters,docs:{...(b=h.parameters)==null?void 0:b.docs,source:{originalSource:`{
  args: {}
}`,...(x=(k=h.parameters)==null?void 0:k.docs)==null?void 0:x.source}}};const H=["Cluster"];export{h as Cluster,H as __namedExportsOrder,G as default};
