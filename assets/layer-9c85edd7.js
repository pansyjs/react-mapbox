import{r as s,R as L}from"./index-76fb7be0.js";import{i as m,u as S}from"./index-2ef8a0ed.js";function g(t,e){if(!t)throw new Error(e)}function d(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!d(t[n],e[n]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),a=Object.keys(e);if(n.length!==a.length)return!1;for(const r of n)if(!e.hasOwnProperty(r)||!d(t[r],e[r]))return!1;return!0}return!1}function q(t,e,n){if(m(t)){const a={...n};return delete a.id,delete a.children,t.addSource(e,a),t.getSource(e)}}function V(t,e,n){g(e.id===n.id,"source id changed"),g(e.type===n.type,"source type changed");let a="",r=0;for(const i in e)i!=="children"&&i!=="id"&&!d(n[i],e[i])&&(a=i,r++);if(!r)return;const o=e.type;if(o==="geojson")t.setData(e.data);else if(o==="image")t.updateImage({url:e.url,coordinates:e.coordinates});else if("setCoordinates"in t&&r===1&&a==="coordinates")t.setCoordinates(e.coordinates);else if("setUrl"in t)switch(a){case"url":t.setUrl(e.url);break;case"tiles":t.setTiles(e.tiles);break}else console.warn(`Unable to update <Source> prop: ${a}`)}let _=0;function p(t){const{map:e}=S(),n=s.useRef(t),[,a]=s.useState(0),r=s.useMemo(()=>t.id||`jsx-source-${_++}`,[]);s.useEffect(()=>{if(e){const i=()=>setTimeout(()=>a(u=>u+1),0);return e.on("styledata",i),i(),()=>{var u;if(e.off("styledata",i),e.getStyle()&&m(e)&&e.getSource(r)){const c=(u=e.getStyle())==null?void 0:u.layers;if(c)for(const f of c)f.source===r&&e.removeLayer(f.id);e.removeSource(r)}}}},[e]);let o=e&&e.getStyle()&&e.getSource(r);return o?V(o,t,n.current):o=q(e,r,t),n.current=t,o&&L.Children.map(t.children,i=>i&&s.cloneElement(i,{source:r}))||null}try{p.displayName="Source",p.__docgenInfo={description:"",displayName:"Source",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"string"}},type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"enum",value:[{value:'"custom"'},{value:'"geojson"'},{value:'"video"'},{value:'"image"'},{value:'"canvas"'},{value:'"vector"'},{value:'"raster"'},{value:'"raster-dem"'}]}},scheme:{defaultValue:null,description:"",name:"scheme",required:!1,type:{name:"string"}},minzoom:{defaultValue:null,description:"",name:"minzoom",required:!1,type:{name:"number"}},maxzoom:{defaultValue:null,description:"",name:"maxzoom",required:!1,type:{name:"number"}},tileSize:{defaultValue:null,description:"",name:"tileSize",required:!1,type:{name:"number"}},attribution:{defaultValue:null,description:"",name:"attribution",required:!1,type:{name:"string"}},_implementation:{defaultValue:null,description:"",name:"_implementation",required:!0,type:{name:"CustomSourceImplementation<unknown>"}}}}}catch{}function z(t,e,n){if(m(t)&&(!("source"in n)||t.getSource(n.source))){const a={...n,id:e};delete a.beforeId,t.addLayer(a,n.beforeId)}}function b(t,e,n,a){if(g(n.id===a.id,"layer id changed"),g(n.type===a.type,"layer type changed"),n.type==="custom"||a.type==="custom")return;const{layout:r={},paint:o={},filter:i,minzoom:u,maxzoom:c,beforeId:f}=n;if(f!==a.beforeId&&t.moveLayer(e,f),r!==a.layout){const y=a.layout||{};for(const l in r)d(r[l],y[l])||t.setLayoutProperty(e,l,r[l]);for(const l in y)r.hasOwnProperty(l)||t.setLayoutProperty(e,l,void 0)}if(o!==a.paint){const y=a.paint||{};for(const l in o)d(o[l],y[l])||t.setPaintProperty(e,l,o[l]);for(const l in y)o.hasOwnProperty(l)||t.setPaintProperty(e,l,void 0)}d(i,a.filter)||t.setFilter(e,i),(u!==a.minzoom||c!==a.maxzoom)&&t.setLayerZoomRange(e,u,c)}let k=0;const h=t=>{const{map:e}=S(),n=s.useRef(t),[,a]=s.useState(0),r=s.useMemo(()=>t.id||`jsx-layer-${k++}`,[]);if(s.useEffect(()=>{if(e){const i=()=>a(u=>u+1);return e.on("styledata",i),i(),()=>{e.off("styledata",i),m(e)&&e.getLayer(r)&&e.removeLayer(r)}}},[e]),m(e)&&e.getLayer(r))try{b(e,r,t,n.current)}catch(i){console.warn(i)}else z(e,r,t);return n.current=t,null};try{h.displayName="Layer",h.__docgenInfo={description:"",displayName:"Layer",props:{type:{defaultValue:null,description:"",name:"type",required:!0,type:{name:"string"}},minzoom:{defaultValue:null,description:"",name:"minzoom",required:!1,type:{name:"number"}},maxzoom:{defaultValue:null,description:"",name:"maxzoom",required:!1,type:{name:"number"}},filter:{defaultValue:null,description:"",name:"filter",required:!1,type:{name:"any"}},source:{defaultValue:null,description:"",name:"source",required:!1,type:{name:"unknown"}},metadata:{defaultValue:null,description:"",name:"metadata",required:!1,type:{name:"any"}},layout:{defaultValue:null,description:"",name:"layout",required:!1,type:{name:"{ [property: string]: any; }"}},paint:{defaultValue:null,description:"",name:"paint",required:!1,type:{name:"{ [property: string]: any; }"}},id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"string"}},beforeId:{defaultValue:null,description:"",name:"beforeId",required:!1,type:{name:"string"}}}}}catch{}export{h as L,p as S};
